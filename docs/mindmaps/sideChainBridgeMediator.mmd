Mind Map generated by NB MindMap plugin
> __version__=`1.1`,showJumps=`true`
---

# xDAI/Ethereum Bridge

## Contracts Structure

### ForeignAMBErc677ToErc677
> collapsed=`true`


#### is MediatorBalanceStorage
> collapsed=`true`


##### function mediatorBalance\(\)
> collapsed=`true`


###### public view

###### function \_setMediatorBalance\(uint256 \_balance\)

#### function executeActionOnBridgedTokens
> collapsed=`true`


##### calls Token\.safeTransfer\(\_recipient, value\)

#### function relayTokens
> collapsed=`true`


##### calls token\.safeTransferFrom\(msg\.sender, \_value\)

##### calls bridgeSpecificActionsOnTokenTransfer

#### function bridgeSpecificActionsOnTokenTransfer
> collapsed=`true`,topicLinkUID=`177A23F7FFEA`


##### calls passMessage

#### function executeActionOnFixedTokens

#### function fixMediatorBalance
> collapsed=`true`,fillColor=`#FFFF00`


##### external onlyIfUpgradeabilityOwner

#### function claimTokens
> collapsed=`true`,fillColor=`#FFFF00`


##### external onlyIfUpgradeabilityOwner

#### is BasicAMBErc677ToErc677
> borderColor=`#808080`,textColor=`#808080`

- TOPIC
<pre>1779B00B78CA</pre>

### is BasicAMBErc677ToErc677
> topicLinkUID=`1779B00B78CA`


#### is BaseERC677Bridge
> topicLinkUID=`1779B01BF14A`


##### is BasicTokenBridge
> topicLinkUID=`1779B02FA5CA`


###### is EternalStorage

###### is Ownable

###### function totalSpentPerDay<br/>function totalExecutedPerDay<br/>function dailyLimit\(\)<br/>function executionDailyLimit\(\)<br/>function maxPerTx\(\)<br/>function executionMaxPerTx\(\)<br/>function minPerTx\(\)<br/>function withinLimit<br/>function withinExecutionLimit<br/>function getCurrentDay\(\)<br/>function maxAvailablePerTx\(\)
> align=`left`


####### public view

###### function setDailyLimit<br/>function setExecutionDailyLimit<br/>function setExecutionMaxPerTx<br/>function setMaxPerTx<br/>function setMinPerTx
> align=`left`


####### external onlyOwner

###### function addTotalSpentPerDay<br/>function addTotalExecutedPerDay
> align=`left`


####### internal

##### is ChooseReceiverHelper

###### function chooseReceiver

####### internal view

##### is IERC677Receiver

###### function onTokenTransfer

####### external

####### calls bridgeSpecificActionsOnTokenTransfer
- TOPIC
<pre>1779BD42723A</pre>

####### calls:<br/>withinLimit<br/>addTotalSpentPerDay
> align=`left`


##### is ERC677Storage

##### function setErc677token

###### internal

#### is TokenBridgeMediator
> topicLinkUID=`1779B04F584A`


##### is BasicTokenBridge
> borderColor=`#808080`,textColor=`#808080`,topicLinkUID=`1779B02FA5CA`

- TOPIC
<pre>1779B02FA5CA</pre>

##### is BasicAMBMediator

###### modifier onlyMediator

###### function setBridgeContract<br/>function setMediatorContractOnOtherSide<br/>function setRequestGasLimit
> align=`left`


####### external onlyOwner

###### function bridgeContract\(\)<br/>function mediatorContractOnOtherSide\(\)<br/>function requestGasLimit\(\)
> align=`left`


####### public view

###### function messageSender\(\)<br/>function messageId\(\)<br/>function maxGasPerTx\(\)
> align=`left`


####### internal view

####### calls bridgeContract\(\)\.xxx
> borderColor=`#FF0000`,fillColor=`#DBDBDB`,textColor=`#FF0000`


##### is TransferInfoStorage
> topicLinkUID=`1779B0CF337A`


###### is EternalStorage

##### function fixFailedMessage
> fillColor=`#FFC800`


###### calls executeActionOnFixedTokens
- TOPIC
<pre>1779BD80C65A</pre>

###### external onlyMediator

##### function handleBridgedTokens
> borderColor=`#0000FF`,fillColor=`#FFC800`,mmd.emoticon=`home_page`


###### calls executeActionOnBridgedTokens
- TOPIC
<pre>1779BDBB991A</pre>

###### calls executeActionOnBridgedTokensOutOfLimit
- TOPIC
<pre>1779BE179A6A</pre>

###### external onlyMediator

##### function passMessage
> topicLinkUID=`177A0751EF8A`


###### calls bridgeContract\(\)\.requireToPassMessage
> borderColor=`#FF0000`,fillColor=`#DBDBDB`,textColor=`#FF0000`


##### function requestFailedMessageFix
> fillColor=`#FFFF00`


###### calls bridgeContract\(\)\.requireToPassMessage
> borderColor=`#FF0000`,fillColor=`#DBDBDB`,textColor=`#FF0000`


#### is BaseOverdrawManagement
> topicLinkUID=`1779B0BAFBDA`


##### is EternalStorage

#### is VersionableBridge

#### is Claimable

##### function claimValues
> topicLinkUID=`1779BDDDE82A`


#### is Upgradeable

#### is Initializable
> topicLinkUID=`1779B10C23EA`


##### is EternalStorage

#### is ReentrancyGuard

#### function relayTokens
> fillColor=`#00FFFF`,mmd.emoticon=`hand_point`


##### calls token\.transferFrom\(msg\.sender, to, \_value\)

##### calls bridgeSpecificActionsOnTokenTransfer
- TOPIC
<pre>177A23F7FFEA</pre>

##### external

#### function onTokenTransfer
> fillColor=`#FFC800`,mmd.emoticon=`home_page`


##### calls bridgeSpecificActionsOnTokenTransfer
- TOPIC
<pre>1779BD42723A</pre>

#### function initialize

#### function executeActionOnBridgedTokensOutOfLimit
> topicLinkUID=`1779BE179A6A`


#### function fixAssetsAboveLimits
> fillColor=`#FFFF00`


##### calls passMessage
- TOPIC
<pre>177A0751EF8A</pre>

### HomeAMBErc677ToErc677

#### is BasicAMBErc677ToErc677
> borderColor=`#808080`,textColor=`#808080`


#### function executeActionOnBridgedTokens
> topicLinkUID=`1779BDBB991A`


##### calls Token\.mint\(\_recipient, value\)

#### function bridgeSpecificActionsOnTokenTransfer
> topicLinkUID=`1779BD42723A`


##### calls passMessage
- TOPIC
<pre>177A0751EF8A</pre>

##### calls Token\.burn\(\_value\)

#### function executeActionOnFixedTokens
> topicLinkUID=`1779BD80C65A`


#### function claimTokens
> fillColor=`#FFFF00`


##### calls claimValues
- TOPIC
<pre>1779BDDDE82A</pre>

##### external onlyIfUpgradeabilityOwner

## List of contracts
> collapsed=`true`,leftSide=`true`


### BaseERC677Bridge
> collapsed=`true`,topicLinkUID=`1779B01BF14A`


#### is BasicTokenBridge

#### is IERC677Receiver

#### is ERC677Storage
- TOPIC
<pre>1779B0A57DEA</pre>

#### is ChooseReceiverHelper
- TOPIC
<pre>1779B0A0F26A</pre>

### Initializable
> collapsed=`true`,topicLinkUID=`1779B10C23EA`


#### is EternalStorage

### BaseOverdrawManagement
> collapsed=`true`,topicLinkUID=`1779B0BAFBDA`


#### is EternalStorage

### Ownable
> collapsed=`true`


#### is EternalStorage

### EternalStorage

### VersionableBridge
> topicLinkUID=`1779B0B092AA`


### Upgradeable
> topicLinkUID=`1779B0AB3A0A`


### ERC677Storage
> topicLinkUID=`1779B0A57DEA`


### ChooseReceiverHelper
> topicLinkUID=`1779B0A0F26A`


### BasicAMBErc677ToErc677
> collapsed=`true`,topicLinkUID=`1779B00B78CA`


#### is Initializable

#### is ReentrancyGuard

#### is Upgradeable
- TOPIC
<pre>1779B0AB3A0A</pre>

#### is Claimable

#### is VersionableBridge
- TOPIC
<pre>1779B0B092AA</pre>

#### is BaseOverdrawManagement

#### is BaseERC677Bridge

#### is TokenBridgeMediator

### BasicTokenBridge
> collapsed=`true`,topicLinkUID=`1779B02FA5CA`


#### is EternalStorage

#### is Ownable

### TokenBridgeMediator
> collapsed=`true`,topicLinkUID=`1779B04F584A`


#### is BasicAMBMediator

#### BasicTokenBridge
- TOPIC
<pre>1779B0C82F5A</pre>

#### TransferInfoStorage

### BasicAMBMediator
> collapsed=`true`,topicLinkUID=`1779B0C82F5A`


#### is Ownable

### TransferInfoStorage
> collapsed=`true`,topicLinkUID=`1779B0CF337A`


#### is EternalStorage

### ReentrancyGuard

## URLs \(Docs\)
> collapsed=`true`,leftSide=`true`


### about\-the\-eth\-xdai\-amb
- LINK
<pre>https://docs.tokenbridge.net/eth-xdai-amb-bridge/about-the-eth-xdai-amb</pre>

### erc677\-to\-erc677\-bridge\-on\-top\-of\-amb
- LINK
<pre>https://docs.tokenbridge.net/amb-bridge/erc677-to-erc677-bridge-on-top-of-amb</pre>

## xDAI/POA BridgeModes
> collapsed=`true`,leftSide=`true`


### AMB Bridge
> collapsed=`true`


#### Transfer arbitrary data between two networks

#### arbitrary\-message\-bridge\-core \(0x2544fbb9\)

### native\-to
> collapsed=`true`


#### Native to ERC20
> collapsed=`true`


##### means\.\.\.
> collapsed=`true`


###### Native coin converted to ERC20\-like token on Ethereum\.<br/>When initiated from the Native side:<br/>\- coins are locked on the Native sidechain<br/>\- and minted on the Ethereum network\.<br/>When bridged in the opposite direction:<br/>\- tokens are burned on the Ethereum side<br/>\- and unlocked in the Native network\.<br/>The POA to POA20 Bridge uses this mode\.
> align=`left`


##### native\-to\-erc\-core \(0x92a8d7fe\)

##### native\-to\-erc\-amb \(0x582ed8fd\)

### erc\-to
> collapsed=`true`


#### ERC20 to ERC20
> collapsed=`true`


##### means\.\.\.
> collapsed=`true`


###### ERC20\-like tokens get locked on the Foreign network \.\.\.<br/>\.\.\. and minted as ERC677 tokens on the Native network\.<br/>When transferred from Native to Foreign,<br/>\- ERC677 tokens are burned<br/>\- ERC20 tokens are unlocked
> align=`left`


##### erc\-to\-erc\-amb \(0x76595b56\)

##### erc\-to\-erc\-core \(0xba4690f5\)

#### ERC20 to Native
> collapsed=`true`


##### means\.\.\.
> collapsed=`true`


###### Coins get locked in the Foreign Network \.\.\.<br/>\.\.\. and ERC20 tokens are minted in the Native network\.<br/>The xDai chain uses this bridge mode\.
> align=`left`


##### erc\-to\-native\-amb \(0xe177c00f\)

##### erc\-to\-native\-core \(0x18762d46\)

### stake\-ecr\-to
> collapsed=`true`


#### stake\-erc\-to\-erc\-amb \(0x16ea01e9\)

### multi\-erc\-to
> collapsed=`true`


#### multi\-erc\-to\-erc\-amb \(0xb1516c26\)

## callFlows
> leftSide=`true`


### Token from Ethereum to xDai

#### on Ethereum

##### ERC677BridgeToken::transferAndCall<br/>\.\.ERC677BridgeToken::\_superTransfer<br/>\.\.\.\.ERC20::transfer<br/>\.\.\.\.\.\.ERC20::\_transfer<br/>\.\.\.\.\.\.\.\.emit Transfer<br/>\.\.emit Transfer<br/>\.\.ERC677BridgeToken::\_contractFallback<br/>\>\>Mediator<br/>\.\.\.\.BasicAMBErc677ToErc677::onTokenTransfer<br/>\.\.\.\.\.\.ForeignStakeTokenMediator::bridgeSpecificActionsOnTokenTransfer<br/>\.\.\.\.\.\.\.\.TokenBridgeMediator::passMessage<br/>\.\.\.\.\.\.\.\.\.\.TokenBridgeMediator::setMessageHashValue<br/>\.\.\.\.\.\.\.\.\.\.TokenBridgeMediator::setMessageHashRecipient<br/>\>\>Bridge<br/>\.\.\.\.\.\.\.\.\.\.MessageDelivery::requireToPassMessage<br/>\.\.\.\.\.\.\.\.\.\.\.\.ForeignAMB::emitEventOnMessageRequest<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.emit UserRequestForAffirmation
> align=`left`


#### on xDai

##### \>\>Bridge<br/>BasicHomeAMB::executeAffirmation<br/>\.\.BasicHomeAMB::handleMessage<br/>\.\.\.\.ArbitraryMessage::unpackData<br/>\.\.\.\.MessageProcessor::processMessage<br/>\.\.\.\.\.\.MessageProcessor::\_passMessage<br/>\.\.\.\.\.\.\.\.MessageProcessor::setMessageSender<br/>\.\.\.\.\.\.\.\.MessageProcessor::setTransactionHash<br/>\>\>Mediator<br/>\.\.\.\.\.\.\.\.TokenBridgeMediator::handleBridgedTokens<br/>\.\.\.\.\.\.\.\.\.\.HomeStakeTokenMediator::executeActionOnBridgedTokens<br/>\>\>Token<br/>\.\.\.\.\.\.\.\.\.\.\.\.MintableToken::mint<br/>\>\>Mediator<br/>\.\.\.\.\.\.\.\.\.\.\.\.emit TokensBridged<br/>\>\>Bridge<br/>\.\.\.\.\.\.MessageProcessor::setMessageCallStatus<br/>\.\.\.\.\.\.HomeAMB::emitEventOnMessageProcessed<br/>\.\.\.\.\.\.\.\.emit AffirmationCompleted
> align=`left`


### Token from xDai to Ethereum

#### on xDai

##### \>\>Token<br/>ERC677BridgeToken::transferAndCall<br/>\.\.ERC677BridgeToken::superTransfer<br/>\.\.\.\.BasicToken::transfer<br/>\.\.\.\.\.\.emit Transfer<br/>\.\.emit Transfer<br/>\.\.ERC677BridgeToken::contractFallback<br/>\>\>Mediator<br/>\.\.\.\.BasicAMBErc677ToErc677::onTokenTransfer<br/>\.\.\.\.\.\.HomeStakeTokenMediator::bridgeSpecificActionsOnTokenTransfer<br/>\>\>Token<br/>\.\.\.\.\.\.\.\.BurnableToken::burn<br/>\.\.\.\.\.\.\.\.\.\.BurnableToken::\_burn<br/>\>\>Mediator<br/>\.\.\.\.\.\.\.\.TokenBridgeMediator::passMessage<br/>\.\.\.\.\.\.\.\.\.\.TokenBridgeMediator::setMessageHashValue<br/>\.\.\.\.\.\.\.\.\.\.TokenBridgeMediator::setMessageHashRecipient<br/>\>\>Bridge<br/>\.\.\.\.\.\.\.\.\.\.MessageDelivery::requireToPassMessage<br/>\.\.\.\.\.\.\.\.\.\.\.\.ForeignAMB::emitEventOnMessageRequest<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.emit UserRequestForSignature<br/>\>\>BlockReward<br/>\.\.\.\.\.\.\.\.HomeStakeTokenFeeManager::\_distributeFee<br/>\.\.\.\.\.\.\.\.\.\.BlockRewardAuRaTokens::addBridgeTokenRewardReceivers
> align=`left`


#### on Ethereum

##### \>\>Bridge<br/>BasicForeignAMB::executeSignatures<br/>\.\.ArbitraryMessage\.unpackData<br/>\.\.\.\.MessageProcessor::processMessage<br/>\.\.\.\.\.\.MessageProcessor::\_passMessage<br/>\.\.\.\.\.\.\.\.MessageProcessor::setMessageSender<br/>\.\.\.\.\.\.\.\.MessageProcessor::setTransactionHash<br/>\>\>Mediator<br/>\.\.\.\.\.\.\.\.TokenBridgeMediator::handleBridgedTokens<br/>\.\.\.\.\.\.\.\.\.\.ForeignStakeTokenMediator::executeActionOnBridgedTokens<br/>\.\.\.\.\.\.\.\.\.\.\.\.ForeignStakeTokenMediator::\_transferWithOptionalMint<br/>\>\>Token<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.ERC677BridgeToken::transfer<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.ERC677BridgeToken::\_superTransfer<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.ERC20::transfer<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.ERC20::\_transfer<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.ERC677BridgeToken::\_callAfterTransfer<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.ERC677BridgeToken::\_contractFallback<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\<TOKENRECEIVER\>::onTokenTransfer<br/>\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\.\<\#\#\#\#\#\#\><br/>\>\>Mediator<br/>\.\.\.\.\.\.\.\.\.\.\.\.emit TokensBridged<br/>\>\>Bridge<br/>\.\.\.\.\.\.MessageProcessor::setMessageCallStatus<br/>\.\.\.\.\.\.ForeignAMB::emitEventOnMessageProcessed<br/>\.\.\.\.\.\.\.\.emit RelayedMessage
> align=`left`

